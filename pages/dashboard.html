<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <title>Activity — RakshaNet</title>
  <style>
    :root {
      --red:#e8193c; --green:#1dd882; --bg:#0c0c0e; --card:#17171b;
      --card2:#1e1e24; --border:rgba(255,255,255,0.07); --border2:rgba(255,255,255,0.12);
      --text:#f2f2f6; --muted:#6e6e82; --muted2:#9898b0;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{background:var(--bg);color:var(--text);font-family:'Nunito',sans-serif;padding:36px 24px;}
    a{color:var(--muted2);text-decoration:none;font-size:13px;font-weight:600;}
    a:hover{color:var(--text);}
    h1{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:.04em;margin:16px 0 6px;}
    .sub{font-size:13px;color:var(--muted);margin-bottom:28px;}
    .list{display:flex;flex-direction:column;gap:8px;max-width:600px;}
    .row{
      background:var(--card);border:1px solid var(--border);
      border-radius:14px;padding:14px 18px;
      display:flex;align-items:center;gap:14px;
      animation: fadeIn .2s ease;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:none}}
    .pip{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
    .pip.danger{background:var(--red);box-shadow:0 0 8px rgba(232,25,60,0.5);}
    .pip.success{background:var(--green);box-shadow:0 0 8px rgba(29,216,130,0.4);}
    .pip.info{background:#4a8eff;}
    .pip.neutral{background:var(--muted);}
    .row-reason{font-size:13px;font-weight:700;}
    .row-time{font-size:11px;color:var(--muted);margin-top:3px;}
    .row-map{margin-left:auto;font-size:12px;color:#4a8eff;text-decoration:none;flex-shrink:0;font-weight:700;}
    .row-map:hover{text-decoration:underline;}
    .empty{color:var(--muted);font-size:14px;padding:24px 0;}
    .badge{
      font-size:11px;padding:3px 10px;border-radius:20px;font-weight:700;margin-left:auto;flex-shrink:0;
    }
    .badge.danger{background:rgba(232,25,60,0.12);color:var(--red);}
    .badge.success{background:rgba(29,216,130,0.1);color:var(--green);}
    .badge.info{background:rgba(74,142,255,0.1);color:#6aabff;}
  </style>
</head>
<body>
  <a href="../index.html">← Back to Home</a>
  <h1>Alert History</h1>
  <p class="sub">All SOS events, timer triggers, and check-ins.</p>
  <div class="list" id="alertList"><p class="empty">Loading…</p></div>

  <script type="module">
    import { auth } from "../src/firebase-init.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    const BACKEND = "https://rakshanetwork-backend.onrender.com";

    function typeOf(reason) {
      const r = reason.toLowerCase();
      if (r.includes("expired") || r.includes("sos")) return "danger";
      if (r.includes("safely") || r.includes("safe"))  return "success";
      return "info";
    }

    async function load(email) {
      const res  = await fetch(`${BACKEND}/logs/${encodeURIComponent(email)}`);
      const data = await res.json();
      const el   = document.getElementById("alertList");
      if (!data.length) { el.innerHTML = '<p class="empty">No alerts recorded yet.</p>'; return; }
      el.innerHTML = "";
      const labels = { danger:"Emergency", success:"Safe", info:"Event" };
      [...data].reverse().forEach(a => {
        const t   = typeOf(a.reason);
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
          <div class="pip ${t}"></div>
          <div>
            <div class="row-reason">${a.reason}</div>
            <div class="row-time">${a.time}</div>
          </div>
          <span class="badge ${t}">${labels[t]}</span>
          ${a.lat ? `<a class="row-map" target="_blank" href="https://www.google.com/maps?q=${a.lat},${a.lng}">Map ↗</a>` : ""}`;
        el.appendChild(row);
      });
    }

    onAuthStateChanged(auth, user => {
      if (user) load(user.email);
      else document.getElementById("alertList").innerHTML =
        '<p class="empty">⚠️ Please login from the home page first.</p>';
    });
  </script>
</body>
</html>